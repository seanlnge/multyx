!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Multyx=e():t.Multyx=e()}(self,()=>(()=>{var __webpack_modules__={2:module=>{class WebSocketServer{constructor({targetWindow:t=window.parent,targetOrigin:e="*"}={}){this.targetWindow=t,this.targetOrigin=e,this.clients=new Set,this.handlers={},console.log("[SERVER] > WebSocketServer initialized"),window.addEventListener("message",this._handleIncomingMessage.bind(this))}on(t,e){this.handlers[t]=e}_emit(t,...e){this.handlers[t]&&this.handlers[t](...e)}_handleIncomingMessage(event){if("BROWSER_WS_CONNECT"===event.data?.type){console.log("[SERVER] > Incoming connection from",event.data.clientId,event.origin);const t=new Websocket(event.source,event.origin,event.data.clientId);this.clients.add(t),t.on("close",()=>this.clients.delete(t)),this._emit("connection",t)}if("BROWSER_WS_MESSAGE"===event.data?.type)for(const t of this.clients)t.clientId===event.data.clientId&&t._emit("message",event.data.payload);if("CONSOLE_INPUT"===event.data?.type)try{const result=eval(event.data.command);console.log("<",result)}catch(t){console.log("< "+t)}if("BROWSER_WS_CLOSE"===event.data?.type)for(const t of this.clients)t.clientId===event.data.clientId&&(t._emit("close"),this.clients.delete(t))}}class Websocket{constructor(t,e,s){this.sourceWindow=t,this.sourceOrigin=e,this.clientId=s,this.handlers={},this.readyState=1}on(t,e){this.handlers[t]=e}_emit(t,...e){this.handlers[t]&&this.handlers[t](...e)}send(t){this.sourceWindow.postMessage({type:"BROWSER_WS_SERVER_SEND",payload:t,clientId:this.clientId},this.sourceOrigin)}close(){this.readyState=3,this.sourceWindow.postMessage({type:"BROWSER_WS_CLOSE",clientId:this.clientId},this.sourceOrigin),this._emit("close")}}module.exports={WebSocketServer,Websocket}},21:(t,e,s)=>{"use strict";var i,n;Object.defineProperty(e,"__esModule",{value:!0});const r=s(590);class a{get relayedValue(){if(this.relayed)return this.value}constructor(t,e,s){this[i]="value",this.min=t=>(t instanceof a&&(t=t.value),this.constraints.set("min",{args:[t],func:e=>e>=t?e:t}),this[r.Get]("min",[t]),this),this.max=t=>(t instanceof a&&(t=t.value),this.constraints.set("max",{args:[t],func:e=>e<=t?e:t}),this[r.Get]("max",[t]),this),this.int=()=>(this.constraints.set("int",{args:[],func:t=>Math.floor("number"==typeof t?t:Number(t))}),this[r.Get]("int",[]),this),this.ban=t=>{var e,s;t instanceof a&&(t=t.value);const i=null!==(s=null===(e=this.constraints.get("ban"))||void 0===e?void 0:e.args)&&void 0!==s?s:[];return i.push(t),this.constraints.set("ban",{args:i,func:t=>i.includes(t)?null:t}),this[r.Get]("ban",i),this},this.constrain=t=>(this.manualConstraints.push(t),this),this.toString=()=>String(this.value),this.valueOf=()=>this.value,this[n]=()=>this.value,this.disabled=!1,this.relayed=!0,this.constraints=new Map,this.manualConstraints=[],this.bannedValues=new Set,this.publicAgents=new Set,this.propertyPath=s,this.agent=e,this.publicAgents.add(this.agent),this.set(t)}set(t){var e,s;t instanceof a&&(t=t.value);for(const[e,{func:s}]of this.constraints.entries()){const e=s(t);if(null===e)return!1;t=e}for(const e of this.manualConstraints){const s=e(t);if(null===s)return!1;t=s}if(this.bannedValues.has(t))return!1;this.value=t,this[r.Send]();const i=Symbol.for("_"+this.propertyPath.join("."));return(null===(e=this.agent.server)||void 0===e?void 0:e.events.has(i))&&(null===(s=this.agent.server)||void 0===s||s.events.get(i).forEach(t=>{t.call(void 0,this),t.saveHistory&&t.delete()})),!0}[(i=r.Item,r.Send)](t){var e;if(!this.relayed)return;const s=new Set;if(t)for(const e of t.clients)s.add(e);else for(const t of this.publicAgents)for(const e of t.clients)s.add(e);null===(e=this.agent.server)||void 0===e||e[r.Edit](this,s)}[r.Get](t,e){var s;for(const i of this.agent.clients)null===(s=this.agent.server)||void 0===s||s[r.Self](i,"constraint",{path:this.propertyPath,name:t,args:e})}[r.Build](){if(!this.relayed)return{};const t={};for(const[e,{args:s}]of this.constraints.entries())t[e]=s;return t}[r.Self](t,e=!0){this.propertyPath=t,e&&this[r.Send]()}disable(){return this.disabled=!0,this.constraints.set("disabled",{args:[!0],func:t=>t}),this[r.Get]("disabled",[!0]),this}enable(){return this.disabled=!1,this.constraints.set("disabled",{args:[!1],func:t=>t}),this[r.Get]("disabled",[!1]),this}relay(){if(this.relayed)return this;this.relayed=!0;for(const[t,{args:e}]of this.constraints.entries())this[r.Get](t,e);return this[r.Send](),this}unrelay(){var t;if(!this.relayed)return this;this.relayed=!1;const e=new Set;for(const t of this.publicAgents)for(const s of t.clients)e.add(s);return null===(t=this.agent.server)||void 0===t||t[r.Remove](this,e),this}addPublic(t){return this.publicAgents.has(t)||(this.publicAgents.add(t),t.addPublic(this),this[r.Send](t)),this}removePublic(t){return this.publicAgents.has(t)?(this.publicAgents.delete(t),t.removePublic(this),new a(void 0,t,this.propertyPath),this):this}isPublic(t){return this.publicAgents.has(t)}}n=Symbol.toPrimitive,e.default=a},85:t=>{function e(t){this.logging=t||!1,this.intervalT1=null,this.timeOutT1=null,this.intervalCount=1,this.deferredInterval=!1,this.deferredTimeout=!1,this.deferredTimeoutRef=null,this.deferredIntervalRef=null,this.timeoutCallbackRef=null,this.intervalCallbackRef=null,this.timeoutImmediateRef=null,this.intervalImmediateRef=null,this.intervalErrorChecked=!1,this.intervalType="",this.timeoutTriggered=!1}e.prototype.time=function(t,e,s,i){const n=performance.now();if(!i){e?t.apply(null,e):t();const i=performance.now()-n;return this._convertTime(i,s)}{const r=this,a=function(){const t=performance.now()-n,e=r._convertTime(t,s);i(e)};e?(e.push(a),t.apply(null,e)):t(a)}},e.prototype._convertTime=function(t,e){switch(e){case"s":return t/1e3;case"m":default:return t;case"u":return 1e3*t;case"n":return 1e6*t}},e.prototype.setInterval=function(t,e,s,i){if(!this.intervalErrorChecked){if(!t||"function"!=typeof t)throw new Error("Task argument to setInterval must be a function reference");if(!s||"string"!=typeof s)throw new Error("Interval argument to setInterval must be a string");i&&"function"==typeof i&&(this.intervalCallbackRef=i),this.intervalType=s[s.length-1];const e=parseInt(s.slice(0,-1));switch(this.intervalType){case"s":this.intervalTime=1e3*e;break;case"m":this.intervalTime=e;break;case"u":this.intervalTime=e/1e3;break;case"n":this.intervalTime=e/1e6;break;default:throw new Error("Invalid interval format")}this.intervalErrorChecked=!0}const n=this;if(this.intervalTime>0){null===this.intervalT1&&(this.intervalT1=performance.now());const r=performance.now()-this.intervalT1,a=this.intervalTime*this.intervalCount;if(r<a){const o=a-r;this.intervalImmediateRef=setTimeout(function(){n.setInterval(t,e,s,i)},o)}else this.logging&&console.log("nanotimer log: cycle time at - "+r),e?t.apply(null,e):t(),this.intervalCount++,this.deferredInterval=!1,this.intervalImmediateRef=setTimeout(function(){n.setInterval(t,e,s,i)},this.intervalTime)}else null===this.intervalT1&&(this.intervalT1=performance.now()),e?t.apply(null,e):t(),this.intervalT1&&(this.intervalImmediateRef=setTimeout(function(){n.setInterval(t,e,s,i)},this.intervalTime))},e.prototype.setTimeout=function(t,e,s,i){if(!t||"function"!=typeof t)throw new Error("Task argument to setTimeout must be a function reference");if(!s||"string"!=typeof s)throw new Error("Delay argument to setTimeout must be a string");let n;switch(i&&"function"==typeof i&&(this.timeoutCallbackRef=i),s[s.length-1]){case"s":n=1e3*parseInt(s.slice(0,-1));break;case"m":n=parseInt(s.slice(0,-1));break;case"u":n=parseInt(s.slice(0,-1))/1e3;break;case"n":n=parseInt(s.slice(0,-1))/1e6;break;default:throw new Error("Invalid delay format")}const r=this;this.timeoutTriggered=!1,null===this.timeOutT1&&(this.timeOutT1=performance.now());const a=performance.now()-this.timeOutT1;if(a<n){const o=n-a;this.timeoutImmediateRef=setTimeout(function(){r.setTimeout(t,e,s,i)},o)}else this.timeoutTriggered=!0,this.timeoutImmediateRef=null,this.timeOutT1=null,this.deferredTimeout=!1,this.logging&&console.log("nanotimer log: actual wait - "+a),e?t.apply(null,e):t(),i&&i({waitTime:a})},e.prototype.clearInterval=function(){this.deferredIntervalRef&&(clearTimeout(this.deferredIntervalRef),this.deferredInterval=!1),this.intervalImmediateRef&&clearTimeout(this.intervalImmediateRef),this.intervalT1=null,this.intervalCount=1,this.intervalErrorChecked=!1,this.intervalCallbackRef&&this.intervalCallbackRef()},e.prototype.clearTimeout=function(){if(!this.timeoutTriggered){let t=0;this.deferredTimeoutRef&&(clearTimeout(this.deferredTimeoutRef),this.timeOutT1&&(t=performance.now()-this.timeOutT1),this.deferredTimeout=!1),this.timeoutImmediateRef&&clearTimeout(this.timeoutImmediateRef),this.timeOutT1=null,this.timeoutCallbackRef&&this.timeoutCallbackRef({waitTime:t})}},e.prototype.hasTimeout=function(){return null!==this.timeOutT1},t.exports=e},129:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MergeRawObjects=function t(e,s){for(const i in s)s[i]instanceof Object&&e.hasOwnProperty(i)&&e[i]instanceof Object?t(e[i],s[i]):e[i]=s[i];return e},e.MapToObject=function(t,e,s){const i=Array.from(t.entries()).map(([t,i])=>[e?e(t):t,s?s(i):i]),n={};for(const[t,e]of i)n[t]=e;return n}},225:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(539)),r=s(662),a=s(590),o=s(776);class l{get clients(){return Array.from(this._clients)}iterateClients(){return this._clients.values()}forEachClient(t){this._clients.forEach(t)}constructor(t,e){var s,i;if(this.public=new Set,this.uuid=t,!(0,r.AddUUID)(t))throw new Error("MultyxTeam name must be unique");this.self=new o.MultyxObject({},this),this.self.clients=[],e?(this._clients=new Set,e.forEach(t=>{this.self.clients.push(t.uuid),t.registerTeam(this),this._clients.add(t)}),this.server=null!==(i=null===(s=this._clients.values().next().value)||void 0===s?void 0:s.server)&&void 0!==i?i:this.server,this.server[a.Edit](this.self,this._clients)):this._clients=new Set}send(t,e){const s=n.default.Create(t,e);for(const t of this._clients)this.server[a.Build](t,s)}getClient(t){for(const e of this._clients)if(e.uuid===t)return e;return null}addClient(t){if(!this._clients.has(t)){this.server||(this.server=t.server),this.self.clients.push(t.uuid),this._clients.add(t),t.registerTeam(this);for(const e of this.public)e[a.Send](t);this.server[a.Edit](this.self,new Set([t]))}}removeClient(t){if(!this._clients.has(t))return;const e=this.self.clients.findIndex(e=>e==t.uuid);-1!==e&&this.self.clients.splice(e,1),this._clients.delete(t),this.removePublic(t.self),t.unregisterTeam(this)}addPublic(t){if(t instanceof o.MultyxValue){if(this.public.has(t))return this;this.public.add(t)}return t.addPublic(this),this}removePublic(t){if(t instanceof o.MultyxValue){if(!this.public.has(t))return this;this.public.delete(t)}return t.removePublic(this),this}[a.Get](){const t=new Map;return this._clients.forEach(e=>t.set(e,e.self[a.Get](this))),t}}e.default=l},234:function(t,e,s){"use strict";var i,n,r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=r(s(21)),o=s(590),l=r(s(971));class h{get value(){return this.data.map(t=>t.value)}get relayedValue(){return this.relayed?this.data.map(t=>t.relayedValue):[]}get length(){return this.data.length}set length(t){for(let e=t;e<this.data.length;e++)this.delete(e)}sendShiftOperation(t,e){if(this.relayed){if(t>0)for(let s=t;s<this.length;s++)this.data[s][o.Self]([...this.propertyPath,(s+e).toString()],!1);new a.default(e,this.agent,[...this.propertyPath,"shift",t.toString()])}}constructor(t,e,s=[e.uuid]){this[i]="list",this.writeCallbacks=[],this.toString=()=>this.value.toString(),this.valueOf=()=>this.value,this[n]=()=>this.value,this.data=[],this.propertyPath=s,this.agent=e,this.disabled=!1,this.relayed=!0,this.publicTeams=new Set,this.allowItemAddition=!0,this.allowItemChange=!0,this.allowItemDeletion=!0,t instanceof h&&(t=t.value);for(const i of t)this.data.push(new((0,l.default)(i))(i,e,[...s,this.data.length.toString()]));return this.constructor!==h?this:new Proxy(this,{has:(t,e)=>"number"==typeof e?t.has(e):e in t,get:(t,e)=>e in t?t[e]:(Number.isInteger(parseInt(e))&&(e=parseInt(e)),t.data[e]),set:(t,e,s)=>e in t?(t[e]=s,!0):!!t.set(e,s),deleteProperty:(t,e)=>"number"==typeof e&&!!t.delete(e)})}disable(){return this.disabled=!0,this.data.forEach(t=>t.disable()),this}enable(){return this.disabled=!1,this.data.forEach(t=>t.enable()),this}relay(){return this.relayed=!0,this.data.forEach(t=>t.relay()),this}unrelay(){return this.relayed=!1,this.data.forEach(t=>t.unrelay()),this}addPublic(t){if(this.publicTeams.has(t))return this;this.publicTeams.add(t);for(const e in this.data)this.data[e].addPublic(t);return this}removePublic(t){if(!this.publicTeams.has(t))return this;this.publicTeams.delete(t);for(const e in this.data)this.data[e].removePublic(t);return this}has(t){return t>=0&&t<this.data.length}get(t){if("number"==typeof t)return this.data[t];if(0==t.length)return this;if(1==t.length)return this.data[parseInt(t[0])];const e=this.data[parseInt(t[0])];return!e||e instanceof a.default?void 0:e.get(t.slice(1))}set(t,e){var s,i;if("string"==typeof t&&(t=parseInt(t)),!Number.isInteger(t))return!1;if(e instanceof o.EditWrapper){if(!this.has(t)&&this.disabled)return!1;if(void 0===e.value&&!this.allowItemDeletion)return!1;if(!this.allowItemAddition&&t>=this.length)return!1;if(!this.allowItemChange&&t<this.length)return!1;e=e.value}else o.Item in e&&(e=e.value);if(void 0===e)return this.delete(t);const n=[...this.propertyPath,t.toString()];o.Item in e?(e[o.Self](n),this.data[t]=e):this.data[t]=new((0,l.default)(e))(e,this.agent,n),this.data[t].disabled=this.disabled,this.data[t].relayed=this.relayed;const r=Symbol.for("_"+this.propertyPath.join(".")+"."+t);return(null===(s=this.agent.server)||void 0===s?void 0:s.events.has(r))&&(null===(i=this.agent.server)||void 0===i||i.events.get(r).forEach(e=>e.call(void 0,this.data[t]))),this}delete(t){return"string"==typeof t&&(t=parseInt(t)),delete this.data[t],t==this.length-1&&(this.length=t),new a.default(void 0,this.agent,[...this.propertyPath,t.toString()]),this}await(t){if(this.has(t))return Promise.resolve(this.get(t));const e=Symbol.for("_"+this.propertyPath.join(".")+"."+t);return new Promise(t=>{var s;return null===(s=this.agent.server)||void 0===s?void 0:s.on(e,(e,s)=>t(s))})}onWrite(t,e){const s=Symbol.for("_"+this.propertyPath.join(".")+"."+t.toString());return this.agent.server.on(s,(t,s)=>e(s))}[(i=o.Item,o.Get)](t){const e=[];for(const s of this.data)s instanceof a.default?s.isPublic(t)?e.push(s.value):e.push(void 0):o.Get in s?e.push(s[o.Get](t)):e.push(void 0);return e}[o.Build](){if(!this.relayed)return[];const t=[];for(const e of this.data)o.Build in e&&t.push(e[o.Build]());return t}[o.Self](t){this.propertyPath=t;for(const e in this.data)o.Self in this.data[e]&&this.data[e][o.Self]([...t,e])}push(...t){return this.data.push(...t.map((t,e)=>new((0,l.default)(t))(t,this.agent,[...this.propertyPath,(this.length+e).toString()]))),this.length}pop(){if(0!=this.length)return this.sendShiftOperation(-1,-1),this.data.pop()}unshift(...t){return this.sendShiftOperation(0,t.length),this.data.unshift(...t.map((t,e)=>new((0,l.default)(t))(t,this.agent,[...this.propertyPath,e.toString()]))),this.length}shift(){if(0!=this.length)return this.sendShiftOperation(1,-1),this.data.shift()}toSpliced(t,e,...s){return e?this.data.splice(t,e,...s):this.data.splice(t)}splice(t,e,...s){void 0===e&&(e=this.length-t);const i=s.length-e;t+e<this.length&&0!=i&&this.sendShiftOperation(t+e,i),0!==i&&this.sendShiftOperation(-1,i);const n=s.map((e,s)=>new((0,l.default)(e))(e,this.agent,[...this.propertyPath,(t+s).toString()]));return this.data.splice(t,e,...n),n}slice(t,e){return this.data.slice(t,e)}setSlice(t,e){if(void 0===t)return this;t<-this.length&&(t=0),t<0&&(t+=this.length),(void 0===e||e>=this.length)&&(e=this.length),e<-this.length&&(e=0),e<0&&(e+=this.length),this.sendShiftOperation(t,-t);for(let s=t;s<e;s++)this.data[s-t]=this.data[s];for(let s=this.length-1;s>=e-t;s--)this.delete(s);return this}filter(t){const e=[];for(let s=0;s<this.length;s++){const i=this.get(s);t(i,s,this)&&i&&e.push(i)}return e}setFilter(t){const e=[];for(let s=0;s<this.length;s++)e.push(t(this.get(s),s,this));let s=0,i=0;for(let t=this.length-1;t>=0;t--)e[t]?(s++,i&&(this.sendShiftOperation(t,-i),i=0)):i++;let n=0;for(let t=0;t<this.length;t++)e[t]?this.data[t-n]=this.data[t]:n++;return this.length=s,this}map(t){const e=[];for(let s=0;s<this.length;s++)e.push(t(this.get(s),s,this));return e}setMap(t){for(let e=0;e<this.length;e++)this.set(e,t(this.get(e),e,this));return this}flat(){return this.data.flat()}setFlat(){for(let t=0;t<this.length;t++){const e=this.get(t);if(e instanceof h)for(let s=0;s<e.length;s++)t++,this.set(t,e[s])}}reduce(t,e){for(let s=0;s<this.length;s++)e=t(e,this.get(s),s,this);return e}reduceRight(t,e){for(let s=this.length-1;s>=0;s--)e=t(e,this.get(s),s,this);return e}reverse(){return this.data.reverse(),this.sendShiftOperation(-1,0),this}forEach(t){for(let e=0;e<this.length;e++)t(this.get(e),e,this)}every(t){for(let e=0;e<this.length;e++)if(!t(this.get(e),e,this))return!1;return!0}some(t){for(let e=0;e<this.length;e++)if(t(this.get(e),e,this))return!0;return!1}find(t){for(let e=0;e<this.length;e++)if(t(this.get(e),e,this))return this.get(e)}findIndex(t){for(let e=0;e<this.length;e++)if(t(this.get(e),e,this))return e;return-1}entries(){const t=[];for(let e=0;e<this.length;e++)t.push([e,this.get(e)]);return t}keys(){return Array(this.length).fill(0).map((t,e)=>e)}values(){return Array(this.length).fill(0).map((t,e)=>this.get(e))}[Symbol.iterator](){const t=[];for(let e=0;e<this.length;e++){const s=this.get(e);s&&(t[e]=s)}return t[Symbol.iterator]()}}n=Symbol.toPrimitive,e.default=h},332:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Event=e.Events=void 0;const i=s(590);e.Events={Connect:Symbol("connect"),Disconnect:Symbol("disconnect"),Update:Symbol("update"),PostUpdate:Symbol("postupdate"),Edit:Symbol("edit"),Input:Symbol("input"),Any:Symbol("any"),Native:Symbol("native"),Custom:Symbol("custom")},e.Event=class{constructor(t,e){this.eventName=t,this.callback=e,this.saveHistory=!1,this.history=[]}call(t=void 0,e={}){const s=this.callback(t,e);this.saveHistory&&this.history.push({time:Date.now(),client:t,data:e,result:s}),void 0!==s&&t&&"string"==typeof this.eventName&&t.server[i.Send](t,this.eventName,s)}delete(){this.callback=t=>t}}},539:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(571);class n{constructor(t,e,s=!1){this.name=t,this.data=e,this.time=Date.now(),this.native=s}static Native(t){const e=[];for(const s of t)e.push((0,i.CompressUpdate)(s));return JSON.stringify(e)}static Create(t,e){if(0==t.length)throw new Error("Multyx message cannot have empty name");if("_"==t[0]&&(t="_"+t),"function"==typeof e)throw new Error("Multyx data must be JSON storable");return JSON.stringify(new n(t,e))}static Parse(t){var e,s;try{const i=JSON.parse(t);return Array.isArray(i)?new n("_",i[0],!0):new n(null!==(e=i.name)&&void 0!==e?e:"",null!==(s=i.data)&&void 0!==s?s:"",!1)}catch(t){return null}}}e.default=n},571:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CompressUpdate=function(t){let e,s;if("edit"==t.instruction&&(e=t.team?"1":"0",s=[t.path.join("."),JSON.stringify(t.value)]),"self"==t.instruction&&(e="controller"==t.property?"2":"uuid"==t.property?"3":"space"==t.property?"9":"4",s=[JSON.stringify(t.data)]),"resp"==t.instruction&&(e="5",s=[t.name,JSON.stringify(t.response)]),"conn"==t.instruction&&(e="6",s=[t.uuid,JSON.stringify(t.publicData)]),"dcon"==t.instruction&&(e="7",s=[t.clientUUID]),"init"==t.instruction&&(e="8",s=[JSON.stringify(t.client),t.tps.toString(),JSON.stringify(t.constraintTable),JSON.stringify(t.clients),JSON.stringify(t.teams),JSON.stringify(t.space)]),!s)return"";let i=e;for(let t=0;t<s.length;t++)void 0===s[t]&&(s[t]="undefined"),i+=s[t].replace(/;/g,";_"),t<s.length-1&&(i+=";,");return i},e.UncompressUpdate=function(t){try{const[e,...s]=t.split(/;,/),i=e[0],n=e.slice(1).replace(/;_/g,";"),r=s.map(t=>t.replace(/;_/g,";")).map(t=>"undefined"==t?void 0:JSON.parse(t));if("0"==i)return{instruction:"edit",team:!1,path:n.split("."),value:r[0]};if("1"==i)return{instruction:"input",input:n,data:r[0]};if("2"==i)return{instruction:"resp",name:n,response:r[0]}}catch(t){return null}}},590:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EditWrapper=e.Item=e.Remove=e.Build=e.Self=e.Send=e.Edit=e.Value=e.Get=e.Parse=void 0,e.Parse=Symbol("parse"),e.Get=Symbol("get"),e.Value=Symbol("value"),e.Edit=Symbol("edit"),e.Send=Symbol("send"),e.Self=Symbol("self"),e.Build=Symbol("build"),e.Remove=Symbol("remove"),e.Item=Symbol.for("_multyxitem"),e.EditWrapper=class{constructor(t){this.value=t}}},631:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=i(s(539)),r=s(662),a=s(776),o=s(590),l=s(640);class h{constructor(t){this.teams=new Set,this.server=t,this.uuid=(0,r.GenerateUUID)(),this.warnings=0,this.networkIssues=0,this.joinTime=Date.now(),this.clients=[this],this.updateSize=0,this.self=new a.MultyxObject({},this),this.controller=new l.Controller(this),this.space="default",this.agentIndex=new Map,this.agentIndex.set(this.uuid,this)}on(t,e){this.server.on(t,(t,s)=>{t==this&&e(s)})}send(t,e){this.server[o.Build](this,n.default.Create(t,e))}await(t,e){return this.send(t,e),new Promise(e=>this.on(t,e))}setSpace(t){this.space=t,this.server[o.Self](this,"space",t)}getSpace(){return this.space}registerTeam(t){this.teams.has(t)||(this.teams.add(t),this.agentIndex.set(t.uuid,t))}unregisterTeam(t){this.teams.has(t)&&(this.teams.delete(t),this.agentIndex.delete(t.uuid))}getAgent(t){return this.agentIndex.get(t)}[o.Parse](){return{uuid:this.uuid,joinTime:this.joinTime,controller:Array.from(this.controller.listening.values()),self:this.self.relayedValue,space:this.space}}}e.default=h},640:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=e.Input=void 0;const i=s(590);var n;!function(t){t.MouseMove="mousemove",t.MouseDown="mousedown",t.MouseUp="mouseup",t.KeyDown="keydown",t.KeyHold="keyhold",t.KeyUp="keyup",t.KeyPress="keypress",t.Shift="Shift",t.Alt="Alt",t.Tab="Tab",t.Control="Control",t.Enter="Enter",t.Escape="Escape",t.Delete="Delete",t.Space="Space",t.CapsLock="CapsLock",t.LeftShift="ShiftLeft",t.RightShift="ShiftRight",t.LeftControl="ControlLeft",t.RightControl="ControlRight",t.LeftAlt="AltLeft",t.RightAlt="AltRight",t.UpArrow="ArrowUp",t.DownArrow="ArrowDown",t.LeftArrow="ArrowLeft",t.RightArrow="ArrowRight"}(n||(e.Input=n={}));class r{constructor(t){this.client=t,this.state={keys:{},mouse:{x:0,y:0,down:!1}},this.listening=new Set,this.events=new Map}listenTo(t,e){Array.isArray(t)||(t=[t]),t.forEach(t=>{var s;if(this.listening.add(t),e){const i=null!==(s=this.events.get(t))&&void 0!==s?s:[];i.push(e),this.events.set(t,i)}}),this.client.server[i.Self](this.client,"controller",Array.from(this.listening))}[i.Parse](t){var e,s,i,r,a,o,l,h,u,c,d,f,p,v,m,g,y,b;switch(t.input){case n.MouseDown:this.state.mouse.x=null===(e=t.data)||void 0===e?void 0:e.x,this.state.mouse.y=null===(s=t.data)||void 0===s?void 0:s.y,this.state.mouse.down=!0,null===(i=this.events.get(n.MouseDown))||void 0===i||i.forEach(t=>t(this.state));break;case n.MouseUp:this.state.mouse.x=null===(r=t.data)||void 0===r?void 0:r.x,this.state.mouse.y=null===(a=t.data)||void 0===a?void 0:a.y,this.state.mouse.down=!1,null===(o=this.events.get(n.MouseUp))||void 0===o||o.forEach(t=>t(this.state));break;case n.MouseMove:this.state.mouse.x=null===(l=t.data)||void 0===l?void 0:l.x,this.state.mouse.y=null===(h=t.data)||void 0===h?void 0:h.y,null===(u=this.events.get(n.MouseMove))||void 0===u||u.forEach(t=>t(this.state));break;case n.KeyUp:delete this.state.keys[null===(c=t.data)||void 0===c?void 0:c.code],null===(d=this.events.get(n.KeyUp))||void 0===d||d.forEach(t=>t(this.state)),null===(p=this.events.get(null===(f=t.data)||void 0===f?void 0:f.code))||void 0===p||p.forEach(t=>t(this.state));break;case n.KeyDown:this.state.keys[null===(v=t.data)||void 0===v?void 0:v.code]=!0,null===(m=this.events.get(n.KeyDown))||void 0===m||m.forEach(t=>t(this.state)),null===(y=this.events.get(null===(g=t.data)||void 0===g?void 0:g.code))||void 0===y||y.forEach(t=>t(this.state));break;case n.KeyHold:null===(b=this.events.get(n.KeyHold))||void 0===b||b.forEach(t=>t(this.state));break;default:console.log("bro how tf you get here")}}}e.Controller=r},645:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultOptions=void 0,e.DefaultOptions={tps:10,port:8443,removeDisconnectedClients:!0,respondOnFrame:!0,sendConnectionUpdates:!0,websocketOptions:{perMessageDeflate:!1}}},662:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GenerateUUID=function t(e=8,i=36){const n=i**(e-1),r=Math.floor(Math.random()*(i*n-n)+n).toString(i);return s.has(r)?t(e,i):(s.add(r),r)},e.AddUUID=function(t){return!s.has(t)&&(s.add(t),!0)};const s=new Set},776:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MultyxValue=e.MultyxObject=e.MultyxList=void 0,e.IsMultyxItem=function(t){return t instanceof n.default||t instanceof r.default||t instanceof a.default};const n=i(s(234));e.MultyxList=n.default;const r=i(s(957));e.MultyxObject=r.default;const a=i(s(21));e.MultyxValue=a.default},806:function(t,e,s){"use strict";var i,n=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var n=Object.getOwnPropertyDescriptor(e,s);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,n)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[e.length]=s);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s=i(t),a=0;a<s.length;a++)"default"!==s[a]&&n(e,t,s[a]);return r(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=a(s(879))},879:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MultyxServer=e.MultyxTeam=e.MultyxObject=e.MultyxList=e.MultyxValue=e.Events=e.Controller=e.Input=e.Client=void 0;const n=s(2),r=i(s(85)),a=s(129),o=i(s(539)),l=s(926);Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return l.Client}}),Object.defineProperty(e,"Input",{enumerable:!0,get:function(){return l.Input}}),Object.defineProperty(e,"Controller",{enumerable:!0,get:function(){return l.Controller}}),Object.defineProperty(e,"MultyxTeam",{enumerable:!0,get:function(){return l.MultyxTeam}});const h=s(776);Object.defineProperty(e,"MultyxList",{enumerable:!0,get:function(){return h.MultyxList}}),Object.defineProperty(e,"MultyxObject",{enumerable:!0,get:function(){return h.MultyxObject}}),Object.defineProperty(e,"MultyxValue",{enumerable:!0,get:function(){return h.MultyxValue}});const u=s(571),c=s(332);Object.defineProperty(e,"Events",{enumerable:!0,get:function(){return c.Events}});const d=s(590),f=s(645);class p{constructor(t={},e){"function"==typeof t&&(e=t,t={}),this.options=Object.assign(Object.assign({},f.DefaultOptions),t),this.options.websocketOptions=Object.assign(Object.assign({},f.DefaultOptions.websocketOptions),t.websocketOptions),this.options.server&&this.options.port&&delete this.options.port,this.options.port&&(this.options.websocketOptions.port=this.options.port),this.options.server&&(this.options.websocketOptions.server=this.options.server),this.events=new Map,this.tps=this.options.tps,this.all=new l.MultyxTeam("all"),this.updates=new Map,this.lastFrame=Date.now(),this.deltaTime=0,this.ws=new WeakMap,new n.WebSocketServer(Object.assign({},this.options.websocketOptions),e).on("connection",t=>{const e=this.connectionSetup(t);this.ws.set(e,t),t.on("message",t=>{var s,i,n;if(!e)return;const r=o.default.Parse(t);if(null==r)return e.warnings++;if(r.native){const t=(0,u.UncompressUpdate)(r.data);if(null==t)return void e.warnings++;this.parseNativeMessage(t,e),null===(s=this.events.get(c.Events.Native))||void 0===s||s.forEach(s=>s.call(e,t))}else null===(i=this.events.get(c.Events.Custom))||void 0===i||i.forEach(t=>t.call(e,r.data)),this.parseCustomMessage(r,e);null===(n=this.events.get(c.Events.Any))||void 0===n||n.forEach(t=>t.call(e))}),t.on("close",()=>{var t;if(e){if(this.ws.delete(e),this.updates.delete(e),null===(t=this.events.get(c.Events.Disconnect))||void 0===t||t.forEach(t=>t.call(e)),this.options.removeDisconnectedClients)for(const t of e.teams)t.removeClient(e);if(this.all.removeClient(e),this.options.sendConnectionUpdates)for(const t of this.all.iterateClients())t!==e&&this.addOperation(t,{instruction:"dcon",clientUUID:e.uuid})}})}),(new r.default).setInterval(this.sendUpdates.bind(this),[],Math.round(1e3/this.tps)+"m")}connectionSetup(t){var e;const s=new l.Client(this);null===(e=this.events.get(c.Events.Connect))||void 0===e||e.forEach(t=>t.call(s)),this.all.addClient(s);const i=t=>{if(!t)return{};const e=Array.isArray(t)?[]:{};return(0,a.MergeRawObjects)(e,t)},n=(t,e,s)=>{if(!s)return;const n=t.get(e);n?(0,a.MergeRawObjects)(n,s):t.set(e,i(s))},r=new Map;r.set(s,i(s.self.relayedValue));for(const t of s.teams){const e=t[d.Get]();for(const[t,i]of e)t!==s&&n(r,t,i)}const h=(0,a.MapToObject)(r,t=>t.uuid),u={};for(const t of s.teams)u[t.uuid]=t.self.relayedValue;const f={[s.uuid]:s.self[d.Build]()};for(const t of s.teams)f[t.uuid]=t.self[d.Build]();t.send(o.default.Native([{instruction:"init",client:s[d.Parse](),tps:this.tps,constraintTable:f,clients:h,teams:u,space:"default"}])),this.updates.set(s,[]);const p=new Map,v=t=>{let e=p.get(t);return e||(e={},p.set(t,e),e)},m=s.self[d.Get](this.all);for(const t of this.all.iterateClients()){if(t===s)continue;const e=v(t);m&&(0,a.MergeRawObjects)(e,m)}for(const t of s.teams){if(t===this.all)continue;const e=s.self[d.Get](t);if(e)for(const i of t.iterateClients()){if(i===s)continue;const t=v(i);(0,a.MergeRawObjects)(t,e)}}if(!this.options.sendConnectionUpdates)return s;for(const t of this.all.iterateClients())t!==s&&this.addOperation(t,{instruction:"conn",uuid:s.uuid,publicData:p.get(t)});return s}parseCustomMessage(t,e){var s;null===(s=this.events.get(t.name))||void 0===s||s.forEach(s=>s.call(e,t.data))}parseNativeMessage(t,e){var s,i,n,r;switch(t.instruction){case"edit":this.parseEditUpdate(t,e),null===(s=this.events.get(c.Events.Edit))||void 0===s||s.forEach(s=>s.call(e,t));break;case"input":e.controller[d.Parse](t),null===(i=this.events.get(c.Events.Input))||void 0===i||i.forEach(t=>t.call(e,e.controller.state));break;case"resp":{const s=null!==(n=this.events.get(Symbol.for("_"+t.name)))&&void 0!==n?n:[];this.events.delete(Symbol.for("_"+t.name)),s.forEach(s=>s.call(e,t.response)),(null!==(r=this.events.get(t.name))&&void 0!==r?r:[]).forEach(s=>s.call(e,t.response));break}}}parseEditUpdate(t,e){var s;const i=t.path.slice(1,-1),n=t.path.slice(-1)[0],r=e.getAgent(t.path[0]);if(!r)return;const a=r.self.get(i);if(a&&!(a instanceof h.MultyxValue)){if(!a.set(n,t.value))return this.addOperation(e,{instruction:"edit",team:r instanceof l.MultyxTeam,path:[...t.path],value:a.value});{const i=null!==(s=this.updates.get(e))&&void 0!==s?s:[],n=i.findIndex(e=>"edit"==e.instruction&&!(!e.path.every((e,s)=>t.path[s]==e)||e.value!=t.value));-1!=n&&(null==i||i.splice(n,1))}}}addOperation(t,e){var s;const i=null!==(s=this.updates.get(t))&&void 0!==s?s:[];i.push(e),this.updates.set(t,i)}compressUpdates(t){const e=[],s=new Map,i=new Map;for(const n of t)if("init"==n.instruction)e.length=0,e.push(n);else if("edit"==n.instruction){if(n.value==Symbol.for("_remove")){s.delete(n.path.join(" "));continue}s.set(n.path.join(" "),n)}else"self"==n.instruction?i.set(n.property,n):e.push(n);for(const t of s.values())e.push(t);for(const t of i.values())e.push(t);return e}sendUpdates(){var t,e,s;this.deltaTime=(Date.now()-this.lastFrame)/1e3,this.lastFrame=Date.now();for(const e of this.all.iterateClients())null===(t=e.onUpdate)||void 0===t||t.call(e,this.deltaTime,e.controller.state);null===(e=this.events.get(c.Events.Update))||void 0===e||e.forEach(t=>t.call());for(const t of this.all.iterateClients()){const e=this.updates.get(t);if(!(null==e?void 0:e.length))continue;const s=this.compressUpdates(e),i=this.ws.get(t);if(!i)continue;if(i.bufferedAmount>4194304){t.networkIssues++;continue}const n=o.default.Native(s);t.updateSize=n.length,i.send(n),e.length=0}null===(s=this.events.get(c.Events.PostUpdate))||void 0===s||s.forEach(t=>t.call())}[d.Edit](t,e){const s={instruction:"edit",team:t.agent instanceof l.MultyxTeam,path:t.propertyPath,value:t.relayedValue};for(const t of e)this.addOperation(t,s)}[d.Remove](t,e){for(const s of e)this.addOperation(s,{instruction:"edit",team:t.agent instanceof l.MultyxTeam,path:t.propertyPath,value:Symbol.for("_remove")})}[d.Self](t,e,s){this.addOperation(t,{instruction:"self",property:e,data:s})}[d.Build](t,e){var s;null===(s=this.ws.get(t))||void 0===s||s.send(e)}[d.Send](t,e,s){var i;this.options.respondOnFrame?this.addOperation(t,{instruction:"resp",name:e,response:s}):null===(i=this.ws.get(t))||void 0===i||i.send(o.default.Native([{instruction:"resp",name:e,response:s}]))}on(t,e){this.events.has(t)||this.events.set(t,[]);const s=new c.Event(t,e);return this.events.get(t).push(s),s}forAll(t){for(const e of this.all.iterateClients())t(e);this.on(c.Events.Connect,t)}}e.MultyxServer=p},926:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MultyxTeam=e.Input=e.Controller=e.Client=void 0;const n=i(s(631));e.Client=n.default;const r=i(s(225));e.MultyxTeam=r.default;const a=s(640);Object.defineProperty(e,"Controller",{enumerable:!0,get:function(){return a.Controller}}),Object.defineProperty(e,"Input",{enumerable:!0,get:function(){return a.Input}})},957:function(t,e,s){"use strict";var i,n,r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=r(s(21)),o=s(590),l=r(s(971));class h{get value(){const t={};for(const e in this.data)t[e]=this.data[e].value;return t}get relayedValue(){if(!this.relayed)return{};const t={};for(const e in this.data){const s=this.data[e].relayedValue;void 0!==s&&(t[e]=s)}return t}constructor(t,e,s=[e.uuid]){this[i]="object",this.toString=()=>this.value.toString(),this.valueOf=()=>this.value,this[n]=()=>this.value;const r={};this.propertyPath=s,this.agent=e,this.disabled=!1,this.relayed=!0,this.publicTeams=new Set,t instanceof h&&(t=t.value);for(const i in t){let n=t[i];(n instanceof h||n instanceof a.default)&&(n=n.value),r[i]=new((0,l.default)(n))(n,e,[...s,i])}return this.data=r,this.constructor!==h?this:new Proxy(this,{has:(t,e)=>t.has(e),get:(t,e)=>e in t?t[e]:t.data[e],set:(t,e,s)=>e in t?(t[e]=s,!0):!!t.set(e,s),deleteProperty:(t,e)=>!!t.delete(e)})}disable(){for(const t in this.data)this.data[t].disable();return this.disabled=!0,this}enable(){for(const t in this.data)this.data[t].enable();return this.disabled=!1,this}relay(){for(const t in this.data)this.data[t].relay();return this.relayed=!0,this}unrelay(){for(const t in this.data)this.data[t].unrelay();return this.relayed=!1,this}addPublic(t){if(this.publicTeams.has(t))return this;this.publicTeams.add(t);for(const e in this.data)this.data[e].addPublic(t);return this}removePublic(t){if(!this.publicTeams.has(t))return this;this.publicTeams.delete(t);for(const e in this.data)this.data[e].removePublic(t);return this}has(t){return t in this.data}get(t){if("string"==typeof t)return this.data[t];if(0==t.length)return this;if(1==t.length)return this.data[t[0]];const e=this.data[t[0]];return!e||e instanceof a.default?void 0:e.get(t.slice(1))}set(t,e){var s,i;if(e instanceof o.EditWrapper&&!this.has(t)&&this.disabled)return!1;if("object"!=typeof e&&this.data[t]instanceof a.default||e instanceof o.EditWrapper&&"object"!=typeof e.value)return!!this.data[t].set(e instanceof o.EditWrapper?e.value:e)&&this;const n=[...this.propertyPath,t];e instanceof h?(e[o.Self](n),this.data[t]=e):((e instanceof a.default||e instanceof o.EditWrapper)&&(e=e.value),this.data[t]=new((0,l.default)(e))(e,this.agent,n)),this.data[t].disabled=this.disabled,this.data[t].relayed=this.relayed;for(const e of this.publicTeams)this.data[t].addPublic(e);const r=Symbol.for("_"+this.propertyPath.join(".")+"."+t);return(null===(s=this.agent.server)||void 0===s?void 0:s.events.has(r))&&(null===(i=this.agent.server)||void 0===i||i.events.get(r).forEach(e=>{e.call(void 0,this.data[t]),e.saveHistory&&e.delete()})),this}delete(t){return delete this.data[t],new a.default(void 0,this.agent,[...this.propertyPath,t]),this}await(t){if(this.has(t))return Promise.resolve(this.get(t));const e=Symbol.for("_"+this.propertyPath.join(".")+"."+t);return new Promise(t=>{var s,i;(null===(i=null===(s=this.agent)||void 0===s?void 0:s.server)||void 0===i?void 0:i.on(e,(e,s)=>t(s))).saveHistory=!0})}onWrite(t,e){const s=Symbol.for("_"+this.propertyPath.join(".")+"."+t);return this.agent.server.on(s,(t,s)=>e(s))}[(i=o.Item,o.Get)](t){const e={};for(const s in this.data){const i=this.data[s];i instanceof a.default?i.isPublic(t)&&(e[s]=i.value):o.Get in i&&(e[s]=i[o.Get](t))}return e}[o.Build](){if(!this.relayed)return{};const t={};for(const e in this.data)if(o.Build in this.data[e]){const s=this.data[e][o.Build]();if(0==Object.keys(s).length)continue;t[e]=s}return t}[o.Self](t){this.propertyPath=t;for(const e in this.data)o.Self in this.data[e]&&this.data[e][o.Self]([...t,e])}entries(){return Object.entries(this.data)}keys(){return Object.keys(this.data)}values(){return Object.values(this.data)}}n=Symbol.toPrimitive,e.default=h},971:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return Array.isArray(t)?s(234).default:"object"==typeof t?s(957).default:s(21).default}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(s.exports,s,s.exports,__webpack_require__),s.exports}var __webpack_exports__=__webpack_require__(806);return __webpack_exports__=__webpack_exports__.default,__webpack_exports__})());